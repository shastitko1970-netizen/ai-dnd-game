# AI Мастер Подземелья - D&D 5e Игра

Полностью готовая к production использованию, full-stack D&D 5e игра с AI Мастером Подземелья, построенная на **Next.js 14**, **Fastify**, и **OpenAI GPT-4**.

## Особенности

✅ **Полная система правил D&D 5e** - Создание персонажей со всеми расами, классами и особенностями  
✅ **AI Мастер Подземелья** - GPT-4 создаёт динамические сюжеты и встречи  
✅ **Система пользовательского контента** - Создавайте собственные расы, классы и особенности  
✅ **Реальная боевая система** - Инициатива, атаки, заклинания, урон  
✅ **Листы персонажей** - Подробные характеристики, навыки, владение оружием  
✅ **Production-ready** - TypeScript везде, полная валидация, обработка ошибок  

## Технологический стек

### Фронтенд
- **Next.js 14** (App Router)
- **React 18** + TypeScript
- **Tailwind CSS** для стилей
- **Zustand** для управления состоянием

### Бэкенд
- **Fastify** с TypeScript
- **OpenAI API** (GPT-4) для AI DM
- **JSON-based хранилище** (можно расширить на MongoDB)

## Структура проекта

```
ai-dnd-game/
├── frontend/          # Next.js приложение
│   ├── app/          # Страницы и макеты
│   ├── components/   # React компоненты
│   ├── lib/          # Утилиты, хранилище, API
│   └── public/       # Статические файлы + dnd-5e-rules.json
├── backend/          # Fastify сервер
│   └── src/
│       ├── routes/   # API endpoints
│       ├── services/ # Бизнес-логика
│       ├── types/    # TypeScript интерфейсы
│       ├── utils/    # Помощники
│       └── data/     # Основные правила + пользовательский контент
└── package.json      # Root конфигурация
```

## Быстрый старт

### Требования
- Node.js 18+
- npm или yarn
- API ключ OpenAI

### Установка

```bash
# Клонирование и установка
git clone https://github.com/shastitko1970-netizen/ai-dnd-game.git
cd ai-dnd-game

# Установка корневых зависимостей
npm install

# Установка фронтенда
cd frontend && npm install && cd ..

# Установка бэкенда
cd backend && npm install && cd ..
```

### Конфигурация

Создай файлы `.env`:

**frontend/.env.local**
```
NEXT_PUBLIC_API_URL=http://localhost:3001
NEXT_PUBLIC_ENVIRONMENT=development
```

**backend/.env**
```
OPENAI_API_KEY=sk-твой-ключ-здесь
PORT=3001
NODE_ENV=development
```

### Запуск

```bash
# Терминал 1: Запуск бэкенда
cd backend
npm run dev

# Терминал 2: Запуск фронтенда
cd frontend
npm run dev

# Открой http://localhost:3000 в браузере
```

## Поток игры

1. **Главная страница** - Начни своё приключение
2. **Выбор мира** - Выбери игровой мир
3. **Создание персонажа** - 3-шаговый мастер (имя, раса/класс, подтверждение)
4. **Игровая сессия** - Играй с AI DM
5. **Пользовательский контент** - Создавай собственные расы, классы, особенности

## Основные концепции

### RulesEngine
Объединяет **основные правила D&D 5e** (неизменяемые) с **пользовательским контентом** (создаваемым пользователями) в единый набор правил для игры.

### Система пользовательского контента
Игроки могут создавать:
- **Собственные расы**: Бонусы характеристик, особенности, скорость
- **Собственные классы**: Кубики здоровья, особенности по уровням
- **Собственные особенности**: Пассивные или активные преимущества

Всё валидируется перед сохранением, нельзя изменять официальный контент.

## API Endpoints

### Правила
- `GET /api/rules/core` - Официальные правила
- `GET /api/rules/merged` - Основные + пользовательские
- `GET /api/rules/spell/:name` - Конкретное заклинание

### Персонаж
- `POST /api/character/create` - Создать персонажа
- `GET /api/character/:id` - Получить персонажа

### Пользовательский контент
- `GET /api/custom-races` - Список собственных рас
- `POST /api/custom-races` - Создать расу
- `PUT /api/custom-races/:name` - Обновить расу
- `DELETE /api/custom-races/:name` - Удалить расу
- То же для `/custom-classes` и `/custom-feats`

### Игра
- `POST /api/game/start` - Начать сессию
- `POST /api/game/action` - Действие игрока
- `POST /api/game/combat/start` - Начать боевой раунд
- `GET /api/game/session/:sessionId` - Получить состояние сессии

## Production-качество

✅ 100% TypeScript  
✅ Полная валидация  
✅ Полная обработка ошибок  
✅ Нет примеров кода  
✅ Нет TODO  
✅ Работает сразу после `npm install`

## Лицензия

MIT

---

**Статус**: Готово к production | **Последнее обновление**: 2025-12-13